{{/*  Check if there are multiple rows  */}}
{{ $multiple := gt (len .hitboxes) 1 }}
{{/*  Initialize all possible columns to false  */}}
{{ $startup := false }}
{{ $active := false }}
{{ $capture := false }}
{{ $airBrakes := false }}
{{ $endlag := false }}
{{ $cancellable := false }}
{{ $firstActiveFrame := false }}
{{ $landingLag := false }}
{{ $cooldown := false }}
{{ $damage := false }}
{{ $angle := false }}
{{ $angleFlipper := false }}
{{ $knockback := false }}
{{ $hitstunModifier := false }}
{{ $forceFlinch := false }}
{{ $untechable := false }}
{{ $hitpause := false }}
{{ $asdiModifier := false }}
{{ $hitLockout := false }}
{{ $priority := false }}
{{ $extendedParryStun := false }}
{{ $killsProjectiles := false }}
{{ $canGalaxy := false }}
{{ $movesRocks := false }}
{{ $setsOnFire := false }}
{{ $consumesFire := false }}
{{ $notes := false}}
{{/*  Iterate through rows, set existing columns to true  */}}
{{ range .hitboxes }}
  {{ if isset . "startup" }} {{ $startup = true }} {{ end }}
  {{ if isset . "active" }} {{ $active = true }} {{ end }}
  {{ if isset . "capture" }} {{ $capture = true }} {{ end }}
  {{ if isset . "airBrakes" }} {{ $airBrakes = true }} {{ end }}
  {{ if isset . "endlag" }} {{ $endlag = true }} {{ end }}
  {{ if isset . "cancellable" }} {{ $cancellable = true }} {{ end }}
  {{ if isset . "firstActiveFrame" }} {{ $firstActiveFrame = true }} {{ end }}
  {{ if isset . "landingLag" }} {{ $landingLag = true }} {{ end }}
  {{ if isset . "cooldown" }} {{ $cooldown = true }} {{ end }}
  {{ if isset . "damage" }} {{ $damage = true }} {{ end }}
  {{ if isset . "angle" }} {{ $angle = true }} {{ end }}
  {{ if isset . "angleFlipper" }} {{ $angleFlipper = true }} {{ end }}
  {{ if isset . "knockback" }} {{ $knockback = true }} {{ end }}
  {{ if isset . "hitstunModifier" }} {{ $hitstunModifier = true }} {{ end }}
  {{ if isset . "forceFlinch" }} {{ $forceFlinch = true }} {{ end }}
  {{ if isset . "untechable" }} {{ $untechable = true }} {{ end }}
  {{ if isset . "hitpause" }} {{ $hitpause = true }} {{ end }}
  {{ if isset . "asdiModifier" }} {{ $asdiModifier = true }} {{ end }}
  {{ if isset . "hitLockout" }} {{ $hitLockout = true }} {{ end }}
  {{ if isset . "priority" }} {{ $priority = true }} {{ end }}
  {{ if isset . "extendedParryStun" }} {{ $extendedParryStun = true }} {{ end }}
  {{ if isset . "killsProjectiles" }} {{ $killsProjectiles = true }} {{ end }}
  {{ if isset . "canGalaxy" }} {{ $canGalaxy = true }} {{ end }}
  {{ if isset . "movesRocks" }} {{ $movesRocks = true }} {{ end }}
  {{ if isset . "setsOnFire" }} {{ $setsOnFire = true }} {{ end }}
  {{ if isset . "consumesFire" }} {{ $consumesFire = true }} {{ end }}
  {{ if isset . "notes" }} {{ $notes = true }} {{ end }}
{{ end }}
{{/*  Dummy variables  */}}
{{ $len := 0 }} {{ $iter := slice 0 }} {{ $counter := 0 }}

<div class="library-table">
  <table>
    <thead>
      <tr>
        {{ if $multiple }}<th class="sticky-col">Hitbox</th>{{ end }}
        {{ if $startup }}<th>Startup</th>{{ end }}
        {{ if $active }}<th>Active</th>{{ end }}
        {{ if $capture }}<th>Capture</th>{{ end }}
        {{ if $airBrakes }}<th>Air Brakes</th>{{ end }}
        {{ if $endlag }}<th>Endlag</th>{{ end }}
        {{ if $cancellable }}<th>Cancellable</th>{{ end }}
        {{ if $firstActiveFrame }}<th>FAF</th>{{ end }}
        {{ if $landingLag }}<th>Landing Lag</th>{{ end }}
        {{ if $cooldown }}<th>Cooldown</th>{{ end }}
        {{ if $damage }}<th>Damage</th>{{ end }}
        {{ if $angle }}<th>Angle</th>{{ end }}
        {{ if $angleFlipper }}<th>Flipper</th>{{ end }}
        {{ if $knockback }}<th>Knockback</th>{{ end }}
        {{ if $hitstunModifier }}<th>Hitstun</th>{{ end }}
        {{ if $forceFlinch }}<th>Force Flinch</th>{{ end }}
        {{ if $untechable }}<th>Untechable</th>{{ end }}
        {{ if $hitpause }}<th>Hitpause</th>{{ end }}
        {{ if $asdiModifier }}<th>ASDI Mod</th>{{ end }}
        {{ if $hitLockout }}<th>Hit Lockout</th>{{ end }}
        {{ if $priority }}<th>Priority</th>{{ end }}
        {{ if $extendedParryStun }}<th>Extended Parry Stun</th>{{ end }}
        {{ if $killsProjectiles }}<th>Kills Projectiles</th>{{ end }}
        {{ if $canGalaxy }}<th>Can Galaxy</th>{{ end }}
        {{ if $movesRocks }}<th>Moves Kragg/SK Rocks</th>{{ end }}
        {{ if $setsOnFire }}<th>Sets On Fire</th>{{ end }}
        {{ if $consumesFire }}<th>Consumes Fire</th>{{ end }}
        {{ if $notes }}<th class="align-left">Notes</th>{{ end }}
      </tr>
    </thead>

    <tbody>
    {{ range .hitboxes }}<tr>

      {{ if $multiple }}<td class="sticky-col">{{ .name }}</td>{{ end }}

      {{ if $startup }}<td>
        {{ if reflect.IsMap .startup }}
          {{ if isset .startup "fromLanding" }}
            {{ .startup.fromLanding }} (From landing)
          {{ end }}
          {{ if isset .startup "loop" -}}
            {{ .startup.initial }} ({{ .startup.loop }} in loop)
          {{ else }}
            {{ with .startup.initial }}{{ . }} (Initial)<br>{{ end }}
            {{ with .startup.cloud }}{{ . }} (Cloud){{ end }}
            {{ with .startup.charge }}{{ . }} (Charge)<br>{{ end }}
            {{ with .startup.dagger }}{{ . }} (Dagger){{ end }}
          {{ end }}
        {{- else }}{{ .startup }}{{ end -}}
      </td>{{ end }}

      {{ if $active }}<td>
        {{ if reflect.IsSlice .active }}
          {{ $len = len .active }}
          {{ range $index, $_ := .active }}
            {{ with .on }}{{ . }}{{ end -}}
            {{ with .from }}{{ . }}-{{ end -}}
            {{ with .to }}{{ . }}{{ end -}}
            {{ if lt (add $index 1) $len }}, {{ end -}}
          {{ end -}}
        {{ else }}
          {{ with .active.on }}{{ . }}{{ end -}}
          {{ with .active.from }}{{ . }}-{{ end -}}
          {{ with .active.to }}{{ . }}{{ end -}}
          {{ with .active.holdExtend }} (Hold attack to extend){{ end -}}
          {{ if reflect.IsMap .active.frames -}}
            {{ with .active.frames.max }} (Max {{ . }}f){{ end -}}
          {{ end -}}

          {{ with .active.minimum }}
            {{ if reflect.IsSlice . }}
              {{ $len = len . }}
              {{ range $index, $_ := . }}
                {{ with .on }}{{ . }}{{ end -}}
                {{ with .from }}{{ . }}-{{ end -}}
                {{ with .to }}{{ . }}{{ end -}}
                {{ if lt (add $index 1) $len }}, {{ end -}}
              {{ end -}}
            {{ else }}
              {{ with .on }}{{ . }}{{ end -}}
              {{ with .from }}{{ . }}-{{ end -}}
              {{ with .to }}{{ . }}{{ end -}}
            {{ end }}
          {{ end }}
          {{ with .active.continue }}
            [
            {{ if reflect.IsSlice . -}}
              {{ $len = len . -}}
              {{ range $index, $_ := . -}}
                {{ with .on }}{{ . }}{{ end -}}
                {{ with .from }}{{ . }}-{{ end -}}
                {{ with .to }}{{ . }}{{ end -}}
                {{ if lt (add $index 1) $len }}, {{ end -}}
              {{ end -}}
            {{ else }}
              {{ with .on }}{{ . }}{{ end -}}
              {{ with .from }}{{ . }}-{{ end -}}
              {{ with .to }}{{ . }}{{ end -}}
            {{ end }}
            ]
          {{ end }}
          {{ with .active.loop }}
            [
            {{ $len = 2 }}{{ $iter = slice . . -}}
            {{- range $index, $_ := $iter }}
              {{- $counter = mul $index (add .frames .gap) -}}
              {{ add .start $counter }}-
              {{- sub (add (add .start .frames) $counter) 1 }}
              {{- if lt (add $index 1) $len }}, {{ else }}...{{ end -}}
            {{ end }}
            ]
          {{- end -}}
          {{ with .active.possible }}
            [
            {{ $len = len . }}
            {{ range $index, $_ := . }}
              {{ with .on }}{{ . }}{{ end -}}
              {{ with .from }}{{ . }}-{{ end -}}
              {{ with .to }}{{ . }}{{ end -}}
              {{ if lt (add $index 1) $len }} / {{ end -}}
            {{ end }}
            ]
          {{ end -}}
          {{- with .active.grounded }}
            Grounded:
            {{ with .on }}{{ . }}{{ end -}}
            {{ with .from }}{{ . }}-{{ end -}}
            {{ with .to }}{{ . }}{{ end }}<br>
          {{ end }}
          {{- with .active.onLanding }}
            On Landing:
            {{ with .on }}{{ . }}{{ end -}}
            {{ with .from }}{{ . }}-{{ end -}}
            {{ with .to }}{{ . }}{{ end }}
          {{- end -}}
        {{ end -}}
      </td>{{ end }}

      {{ if $capture }}<td>
        {{ if isset . "capture" }}{{ .capture.from }}-{{ end }}
      </td>{{ end }}

      {{ if $airBrakes }}<td>
        {{ if isset .airBrakes "during" }}
          During {{ .airBrakes.during }}
        {{ else }}
          {{ with .airBrakes.from }}f{{ . }}-{{ end -}}
          {{ with .airBrakes.to }}{{ . }}{{ end }}
        {{ end }}
      </td>{{ end }}

      {{ if $endlag }}<td>
        {{ if isset .endlag "hit" }}
          {{ .endlag.hit }} /
          {{ with .endlag.whiff }}
            {{ if isset . "bothHits" }}
              <br>{{ .bothHits }} (Whiff both Hit 1-2)
              <br>{{ .onlyHit2 }} (Whiff only Hit 2)
            {{- else }}{{ . }}{{ end -}}
          {{ else }} - {{ end -}}<br>
        {{ end }}
        {{ if reflect.IsMap .endlag }}
          {{ with .endlag.grounded }}Grounded: {{ . }}<br>{{ end }}
          {{ with .endlag.airborne }}Airborne: {{ . }}<br>{{ end }}
          {{ with .endlag.cancel }}
            Cancel: {{ if reflect.IsMap . }}{{ .hit }} / {{ .whiff }}{{ else }}{{ . }}{{ end }}
          {{ end }}
          {{ if isset .endlag "overTwoGloves" }}
            {{ .endlag.twoOrLessGloves }} ({{ .endlag.overTwoGloves }} if >2 gloves are thrown)
          {{ end }}
          {{ with .endlag.fromAnchorReachingSK }}From Anchor Reaching SK: {{ . }}{{ end }}
        {{ else }}{{ .endlag }}{{ end }}
      </td>{{ end }}

      {{ if $cancellable }}<td>
        {{ range .cancellable }}
          {{ .with }}
          {{- with .input }} (Input {{ . }}){{ end }}
          {{- if .onlyOnHit }} (On Hit){{ end }}
          {{- if .onlyGrounded }} (While grounded){{ end }}:
          {{ with .during }}{{ title . }} {{ end -}}
          {{ with .windows -}}
            {{ $len = len . -}}
            {{ range $index, $_ := . -}}
              {{ with .on }}{{ . }}{{ end -}}
              {{ with .from }}{{ . }}-{{ end -}}
              {{ with .to }}{{ . }}{{ end -}}
              {{ with .endlag }}({{ . }}f Endlag){{ end -}}
              {{ if lt (add $index 1) $len }},{{ end -}}
            {{ end -}}
            <br>
          {{ else -}}
            {{ if isset . "hit" -}}
              {{ with .hit.on }}{{ . }}{{ end -}}
              {{ with .hit.from }}{{ . }}-{{ end -}}
              {{ with .hit.to }}{{ . }}{{ end }} /
              {{ with .whiff.on }}{{ . }}{{ end -}}
              {{ with .whiff.from }}{{ . }}-{{ end -}}
              {{ with .whiff.to }}{{ . }}{{ end -}}
            {{ else -}}
              {{ with .on }}{{ . }}{{ end -}}
              {{ with .from }}{{ . }}-{{ end -}}
              {{ with .to }}{{ . }}{{ end -}}
              {{ with .endlag }} ({{ . }}f Endlag){{ end -}}
            {{ end }}
            <br>
          {{ end -}}
        {{ end -}}
      </td>{{ end }}

      {{ if $firstActiveFrame }}<td>
        {{ if reflect.IsMap .firstActiveFrame }}
          {{ if isset .firstActiveFrame "hit" }}
            {{ .firstActiveFrame.hit }} /
            {{ with .firstActiveFrame.whiff }}{{ . }}{{ else }}-{{ end }}<br>
          {{ end }}
          {{ with .firstActiveFrame.minimum }}{{ . }} (Minimum){{ end }}
          {{ with .firstActiveFrame.possible }}
            [
            {{ $len = len . }}
            {{ range $index, $_ := . }}
              {{ . }}{{ if lt (add $index 1) $len }} / {{ end -}}
            {{ end -}}
            ]
          {{ end -}}
          {{ with .firstActiveFrame.grounded }}Grounded: {{ . }}<br>{{ end }}
          {{ with .firstActiveFrame.onLanding }}On Landing: {{ . }}{{ end }}
          {{ with .firstActiveFrame.pratFall }}Prat Fall w/ Landing Lag: {{ . }}<br>{{ end }}
          {{ with .firstActiveFrame.cancel }}
            Cancel: {{ if reflect.IsMap . }}{{ .hit }} / {{ .whiff }}{{ else }}{{ . }}{{ end }}
          {{ end }}
          {{ with .firstActiveFrame.maximum }}Maximum: {{ . }}<br>{{ end }}
          {{ with .firstActiveFrame.anchorIsUnableToCast }}Anchor is unable to cast: {{ . }}{{ end }}
          {{ with .firstActiveFrame.fromAnchorReachingSK }}From Anchor Reaching SK: {{ . }}{{ end }}
          {{ with .firstActiveFrame.shop }}Shop: {{ . }}{{ end }}
        {{- else }}
          {{ .firstActiveFrame }}
        {{ end -}}
      </td>{{ end }}

      {{ if $landingLag }}<td>
        {{ if isset .landingLag "hit" }}
          {{ .landingLag.hit }} / {{ .landingLag.whiff -}}
        {{ else }}
          {{ .landingLag }}
        {{ end -}}
      </td>{{ end }}

      {{ if $cooldown }}<td>
        {{ if reflect.IsSlice .cooldown }}
          {{ $len = len .cooldown }}
          {{ range $index, $_ :=.cooldown }}
            {{ with .move }}{{ . }}:{{ end }}
            {{ .time -}}
            {{ with .on }} (On {{ . }}){{ end }}
            {{ if lt (add $index 1) $len }}<br>{{ end -}}
          {{ end }}
        {{- else }}{{ .cooldown }}{{ end -}}
      </td>{{ end }}

      {{ if $damage }}<td>
        {{ if isset . "damage" }}
          {{ if reflect.IsMap .damage }}
            {{ with .damage.creation }}Creation: {{ . }}%<br>{{ end }}
            {{ with .damage.movedBy }}
              {{ $len = len . }}
              {{ range $index, $_ := . }}
                Moved by {{ .move }}:
                {{ if isset .damage "from" }}
                  {{ with .damage.from }}{{ . }}-{{ end -}}
                  {{ with .damage.to }}{{ . }}{{ end }}%
                  {{ with .damage.scaling }}({{ . }}){{ end -}}
                {{ else -}}
                  {{ .damage -}}%
                {{- end }}
                {{- if lt (add $index 1) $len }}<br>{{ end -}}
              {{ end -}}
            {{ end -}}
          {{ else }}{{ .damage }}%{{ end -}}
        {{ end -}}
      </td>{{ end }}

      {{ if $angle }}<td>
        {{ if isset . "angle" }}{{ .angle }}°{{ end }}
      </td>{{ end }}

      {{ if $angleFlipper }}<td>{{ .angleFlipper }}</td>{{ end }}

      {{ if $knockback }}<td>{{ with .knockback }}
        {{ if isset .base "from" }}
          {{ with .base.from }}{{ . }}-{{ end -}}
          {{ with .base.to }}{{ . }}{{ end }}
          {{ with .base.scaling }}({{ . }}){{ end }}
           | {{ .scaling -}}
        {{ else -}}
          {{ .base }} | {{ .scaling }}
        {{ end -}}
      {{ end }}</td>{{ end }}

      {{ if $hitstunModifier }}<td>
        {{ if isset . "hitstunModifier" }}{{ .hitstunModifier }}×{{ end }}
      </td>{{ end }}

      {{ if $forceFlinch }}<td>{{ .forceFlinch }}</td>{{ end }}

      {{ if $untechable }}<td>
        {{ if isset .untechable "note" }}
          <div class="untechable-note">{{ .untechable.note }}</div>
        {{ else }}
          {{ title .untechable }}
        {{ end }}
      </td>{{ end }}

      {{ if $hitpause }}<td>
        {{ with .hitpause }}{{ .base }} | {{ .scaling }}{{ end -}}
        {{ with .hitpause.extra }}<br>(+{{ . }}){{ end -}}
      </td>{{ end }}

      {{ if $asdiModifier }}<td>
        {{ if isset . "asdiModifier" }}{{ .asdiModifier }}×{{ end }}
      </td>{{ end }}

      {{ if $hitLockout }}<td>{{ .hitLockout }}</td>{{ end }}

      {{ if $priority }}<td>
        {{ if reflect.IsSlice .priority }}
          {{ $len = len .priority }}
          {{ range $index, $_ := .priority }}
            {{ .priority }}{{ if lt (add $index 1) $len }} / {{ end -}}
          {{ end }}
        {{- else }}{{ .priority }}{{ end -}}
      </td>{{ end }}

      {{ if $extendedParryStun }}<td>{{ title .extendedParryStun }}</td>{{ end }}

      {{ if $killsProjectiles }}<td>{{ title .killsProjectiles }}</td>{{ end }}

      {{ if $canGalaxy }}<td>{{ title .canGalaxy }}</td>{{ end }}

      {{ if $movesRocks}}<td>{{ title .movesRocks }}</td>{{ end }}

      {{ if $setsOnFire }}<td>{{ title .setsOnFire }}</td>{{ end }}

      {{ if $consumesFire }}<td>{{ title .consumesFire }}</td>{{ end }}

      {{ if $notes }}<td><div class="notes align-left">
        {{ range .notes }}{{ . }} {{ end }}
      </div></td>{{ end }}

    </tr>{{ end }}
    </tbody>
  </table>
</div>

{{ with .notes }}
  <p class="move-notes">{{ range . }}{{ . }} {{ end }}</p>
{{ end }}

{{ with .image.highRes }}
  <div class="hitbox-image">
    <img src="{{ . }}" alt="In-game screenshot of this attack's hitbox{{ with $multiple }}es{{ end }}">
  </div>
{{ end }}
